### Citadele usage

#### Add secret environmental variables (nano /etc/environment)
```
CITADELE_PRIVATE_CERT="QqIIFhDCCA2wCCQCegSod3..." # Your certificate stripped of first and last line (the ----BEGIN CERTIFICATE stuff)
CITADELE_IDENTIFIER="10000" # Your identifier here
```

#### Configure defaults
```ruby
SacPS::Auth::Citadele.return_url = "https://your-domain.com/auth/citadele"
SacPS::Auth::Citadele.identifier = ENV["CITADELE_IDENTIFIER"] # gets initialized from env like this by default
SacPS::Auth::Citadele.service_url = "https://online.citadele.lv/amai/start.htm" # set by default
SacPS::Auth::Citadele.public_key = File.read("#{Rails.root}/certs/citadele.crt")
SacPS::Auth::Citadele.private_key = File.read("#{Rails.root}/certs/citadele.key")
```

#### Initialize the helper
```ruby
@request_helper = SacPS::Auth::Citadele.helper
```

#### Build an automatic submit form
Use SacPS::Auth::Citadele.service_url and @request_helper.xml

```
# views/auth/citadele/new.html.erb
<html>
  <head>
  </head>
  <body onload="document.citadeleForm.submit();" style="display:none;">
  <form method="POST" name="citadeleForm" action="<%= SacPS::Auth::Citadele.service_url %>">
    <input type="hidden" id="xmldata" name="xmldata" value="<%= @request_helper.xml %>">
    <input type="submit" value="Send">
  </form>
  </body>
</html>
```

#### Expect a response at the return_url you specified
##### Instantiate a notification object
```ruby
@response = SacPS::Auth::Citadele.notification(params[:xmlResponse])
```

##### Check if response is valid and process
```ruby
if @response.ok?
  @response.user_identifier #=> "123456-12345"
  @response.user_name       #=> "BĒRZIŅŠ JĀNIS" (< Citadele default)
  @response.from            #=> "CITADELE"
```
